<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>무릉 도우미</title>

</head>
<body>
  <video id="video" autoplay playsinline style="display:none;"></video>
  <video id="pip_video" autoplay playsinline style="display:none;"></video>
  <button id="sharing_btn">화면 공유</button><br>
  <button id="sharing_end_btn" disabled>화면 공유 중지</button><br>
  <button id="pip_btn" disabled>PIP</button><br>

  <div id="screen" style="display:none;">
    <span id="monitoring_button" style="color:blue;text-decoration:underline;cursor:pointer;">공유 화면</span>
    <canvas id="canvas" width="800" height="150" style="display:none;margin-left:0;margin-right:auto;max-width:100%;background-color:black;"></canvas>
  </div>

<script>
const videoElement = document.querySelector('#video')
const startButton = document.querySelector('#sharing_btn')
const stopButton = document.querySelector('#sharing_end_btn')
const pipButton = document.querySelector('#pip_btn')

async function startCapture() {
  try {
    const displayMediaOptions = { audio: false, video: {cursor: 'always'} }
    cosnt captureStream = await navigator.mediaDevices.getDisplayMedia(displayMediaOptions)
    videoElement.srcObject = captureStream
    startButton.disabled = true
    stopButton.disabled = false
    pipButton.disabled = false
    //
  } catch(err) {
    console.error(err)
  }
}

function stopCapture() {
  const tracks = videoElement.srcObject.getTracks()
  tracks.forEach((track) => track.stop())
  videoElement.srcObject = null
  startButton.disabled = false
  stopButton.disabled = true
  pipButton.disabled = true
}

startButton.addEventListener('click', startCapture)
stopButton.addEventListener('click', stopCapture)

</script>
